\hypertarget{fft__funct_8cpp}{}\doxysection{fft\+\_\+funct.\+cpp File Reference}
\label{fft__funct_8cpp}\index{fft\_funct.cpp@{fft\_funct.cpp}}
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}fft\+\_\+funct.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}parabola.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{fft__funct_8cpp_a598a3330b3c21701223ee0ca14316eca}{PI}}~3.\+14159265358979323
\item 
\#define \mbox{\hyperlink{fft__funct_8cpp_aa13333deabc79b60cecf8550c8ca21e4}{Ns}}~2048
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{fft__funct_8cpp_af45ac7950e3e8e370f6fb1a1685cb4eb}{CalcolaW}} (int n)
\item 
void \mbox{\hyperlink{fft__funct_8cpp_a751500033661e2f8c0b7e19b1574797c}{fft\+\_\+funct}} (float $\ast$buffer, int size, float tet, float f0, int nharms, int Fs)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
double \mbox{\hyperlink{fft__funct_8cpp_adcb271474200e554045b11f58f5675ef}{Wre}} \mbox{[}\mbox{\hyperlink{fft__funct_8cpp_aa13333deabc79b60cecf8550c8ca21e4}{Ns}}/2\mbox{]}
\item 
double \mbox{\hyperlink{fft__funct_8cpp_a3dd642bdf6aceeca1d22bcb1b32cfd8c}{Wim}} \mbox{[}\mbox{\hyperlink{fft__funct_8cpp_aa13333deabc79b60cecf8550c8ca21e4}{Ns}}/2\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{fft__funct_8cpp_aa13333deabc79b60cecf8550c8ca21e4}\label{fft__funct_8cpp_aa13333deabc79b60cecf8550c8ca21e4}} 
\index{fft\_funct.cpp@{fft\_funct.cpp}!Ns@{Ns}}
\index{Ns@{Ns}!fft\_funct.cpp@{fft\_funct.cpp}}
\doxysubsubsection{\texorpdfstring{Ns}{Ns}}
{\footnotesize\ttfamily \#define Ns~2048}

\mbox{\Hypertarget{fft__funct_8cpp_a598a3330b3c21701223ee0ca14316eca}\label{fft__funct_8cpp_a598a3330b3c21701223ee0ca14316eca}} 
\index{fft\_funct.cpp@{fft\_funct.cpp}!PI@{PI}}
\index{PI@{PI}!fft\_funct.cpp@{fft\_funct.cpp}}
\doxysubsubsection{\texorpdfstring{PI}{PI}}
{\footnotesize\ttfamily \#define PI~3.\+14159265358979323}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{fft__funct_8cpp_af45ac7950e3e8e370f6fb1a1685cb4eb}\label{fft__funct_8cpp_af45ac7950e3e8e370f6fb1a1685cb4eb}} 
\index{fft\_funct.cpp@{fft\_funct.cpp}!CalcolaW@{CalcolaW}}
\index{CalcolaW@{CalcolaW}!fft\_funct.cpp@{fft\_funct.cpp}}
\doxysubsubsection{\texorpdfstring{CalcolaW()}{CalcolaW()}}
{\footnotesize\ttfamily void CalcolaW (\begin{DoxyParamCaption}\item[{int}]{n }\end{DoxyParamCaption})}

\mbox{\Hypertarget{fft__funct_8cpp_a751500033661e2f8c0b7e19b1574797c}\label{fft__funct_8cpp_a751500033661e2f8c0b7e19b1574797c}} 
\index{fft\_funct.cpp@{fft\_funct.cpp}!fft\_funct@{fft\_funct}}
\index{fft\_funct@{fft\_funct}!fft\_funct.cpp@{fft\_funct.cpp}}
\doxysubsubsection{\texorpdfstring{fft\_funct()}{fft\_funct()}}
{\footnotesize\ttfamily void fft\+\_\+funct (\begin{DoxyParamCaption}\item[{float $\ast$}]{buffer,  }\item[{int}]{size,  }\item[{float}]{tet,  }\item[{float}]{f0,  }\item[{int}]{nharms,  }\item[{int}]{Fs }\end{DoxyParamCaption})}

In the fft\+\_\+funct the first thing to do is to calculate the closest power of two to the size of the input vector. Then the new buffer size is called NC (in case the input vector\textquotesingle{}s dimension is already a power of two, then NC is equal to the input vector\textquotesingle{}s length) ~\newline


Then another vector is calculated, it will be used for the parabolic interpolation and it is called fc\mbox{[}\mbox{]}

The Goertzel algorithm is used to calculate the FFT, this algorithm uses decimation in time dividing the input sequence in blocks until each block contains only to samples to be combined, please read the document Tesina di informatica II.\+pdf for having a clearer understanding of the procedure ~\newline


Xre is the rewritten input vector with inverted bit position (see the Goertzel algorithm), Xim is not calculated because in fact we don\textquotesingle{}t use the imaginary part

The coefficient calculation Wre and Wim could have been done at the beginning

The input buffer is overwritten with the amplitude of the fft points

Here the closest peak calculation is performed in order to find the peaks on which the parabolic interpolation should be calculated ~\newline
For each note (fc\mbox{[}\mbox{]}) we search the Fourier frequency (index\mbox{[}\mbox{]}) closest to the fundamental frequency of that note

Then we pass to the parabola calculation the 3 points around that RTFI frequency and we calculate the parabola coefficients A, B and C ~\newline
and use those coefficients to calculate the estimated amplitude of the RTFI frequency

Finally we overwrite the Fourier output with the values corrected from the parabolic interpolation. ~\newline
Indeed we don\textquotesingle{}t take full advantage of the parabolic interpolation which could be used to estimate the correct position in frequency of the point. This is a choice we made because we supposed that we don\textquotesingle{}t need to estimate the correct position in frequency of the peak because we already know it, that\textquotesingle{}s why we use the RTFI technique; but in case of the guitar this parabolic interpolation could be also used for estimating the correct frequency during \char`\"{}bendings\char`\"{} even tough we could be precise only on high pitched notes. ~\newline
 Another thing that should be evaluated is the possibility to analyze a larger buffer, this should be done considering the CPU power we have at our disposal, from this Goertzel implementation documentation we have the complexity of the algorithm which is roughly NlogN

\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{fft__funct_8cpp_a3dd642bdf6aceeca1d22bcb1b32cfd8c}\label{fft__funct_8cpp_a3dd642bdf6aceeca1d22bcb1b32cfd8c}} 
\index{fft\_funct.cpp@{fft\_funct.cpp}!Wim@{Wim}}
\index{Wim@{Wim}!fft\_funct.cpp@{fft\_funct.cpp}}
\doxysubsubsection{\texorpdfstring{Wim}{Wim}}
{\footnotesize\ttfamily double Wim\mbox{[}\mbox{\hyperlink{fft__funct_8cpp_aa13333deabc79b60cecf8550c8ca21e4}{Ns}}/2\mbox{]}}

\mbox{\Hypertarget{fft__funct_8cpp_adcb271474200e554045b11f58f5675ef}\label{fft__funct_8cpp_adcb271474200e554045b11f58f5675ef}} 
\index{fft\_funct.cpp@{fft\_funct.cpp}!Wre@{Wre}}
\index{Wre@{Wre}!fft\_funct.cpp@{fft\_funct.cpp}}
\doxysubsubsection{\texorpdfstring{Wre}{Wre}}
{\footnotesize\ttfamily double Wre\mbox{[}\mbox{\hyperlink{fft__funct_8cpp_aa13333deabc79b60cecf8550c8ca21e4}{Ns}}/2\mbox{]}}


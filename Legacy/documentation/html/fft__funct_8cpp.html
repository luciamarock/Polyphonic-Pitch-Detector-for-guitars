<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Audio Analyzer: fft_funct.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Audio Analyzer
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Author: Luciano Ciamarone -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">fft_funct.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;<a class="el" href="fft__funct_8h_source.html">fft_funct.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="parabola_8h_source.html">parabola.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a598a3330b3c21701223ee0ca14316eca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fft__funct_8cpp.html#a598a3330b3c21701223ee0ca14316eca">PI</a>&#160;&#160;&#160;3.14159265358979323</td></tr>
<tr class="separator:a598a3330b3c21701223ee0ca14316eca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa13333deabc79b60cecf8550c8ca21e4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fft__funct_8cpp.html#aa13333deabc79b60cecf8550c8ca21e4">Ns</a>&#160;&#160;&#160;2048</td></tr>
<tr class="separator:aa13333deabc79b60cecf8550c8ca21e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af45ac7950e3e8e370f6fb1a1685cb4eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fft__funct_8cpp.html#af45ac7950e3e8e370f6fb1a1685cb4eb">CalcolaW</a> (int n)</td></tr>
<tr class="separator:af45ac7950e3e8e370f6fb1a1685cb4eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a751500033661e2f8c0b7e19b1574797c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fft__funct_8cpp.html#a751500033661e2f8c0b7e19b1574797c">fft_funct</a> (float *buffer, int size, float tet, float f0, int nharms, int Fs)</td></tr>
<tr class="separator:a751500033661e2f8c0b7e19b1574797c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:adcb271474200e554045b11f58f5675ef"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fft__funct_8cpp.html#adcb271474200e554045b11f58f5675ef">Wre</a> [<a class="el" href="fft__funct_8cpp.html#aa13333deabc79b60cecf8550c8ca21e4">Ns</a>/2]</td></tr>
<tr class="separator:adcb271474200e554045b11f58f5675ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dd642bdf6aceeca1d22bcb1b32cfd8c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fft__funct_8cpp.html#a3dd642bdf6aceeca1d22bcb1b32cfd8c">Wim</a> [<a class="el" href="fft__funct_8cpp.html#aa13333deabc79b60cecf8550c8ca21e4">Ns</a>/2]</td></tr>
<tr class="separator:a3dd642bdf6aceeca1d22bcb1b32cfd8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aa13333deabc79b60cecf8550c8ca21e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa13333deabc79b60cecf8550c8ca21e4">&#9670;&nbsp;</a></span>Ns</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Ns&#160;&#160;&#160;2048</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a598a3330b3c21701223ee0ca14316eca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a598a3330b3c21701223ee0ca14316eca">&#9670;&nbsp;</a></span>PI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PI&#160;&#160;&#160;3.14159265358979323</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="af45ac7950e3e8e370f6fb1a1685cb4eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af45ac7950e3e8e370f6fb1a1685cb4eb">&#9670;&nbsp;</a></span>CalcolaW()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CalcolaW </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a751500033661e2f8c0b7e19b1574797c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a751500033661e2f8c0b7e19b1574797c">&#9670;&nbsp;</a></span>fft_funct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fft_funct </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>f0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nharms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Fs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>In the fft_funct the first thing to do is to calculate the closest power of two to the size of the input vector. Then the new buffer size is called NC (in case the input vector's dimension is already a power of two, then NC is equal to the input vector's length) <br  />
</p>
<p>Then another vector is calculated, it will be used for the parabolic interpolation and it is called fc[]</p>
<p>The Goertzel algorithm is used to calculate the FFT, this algorithm uses decimation in time dividing the input sequence in blocks until each block contains only to samples to be combined, please read the document Tesina di informatica II.pdf for having a clearer understanding of the procedure <br  />
</p>
<p>Xre is the rewritten input vector with inverted bit position (see the Goertzel algorithm), Xim is not calculated because in fact we don't use the imaginary part</p>
<p>The coefficient calculation Wre and Wim could have been done at the beginning</p>
<p>The input buffer is overwritten with the amplitude of the fft points</p>
<p>Here the closest peak calculation is performed in order to find the peaks on which the parabolic interpolation should be calculated <br  />
For each note (fc[]) we search the Fourier frequency (index[]) closest to the fundamental frequency of that note</p>
<p>Then we pass to the parabola calculation the 3 points around that RTFI frequency and we calculate the parabola coefficients A, B and C <br  />
and use those coefficients to calculate the estimated amplitude of the RTFI frequency</p>
<p>Finally we overwrite the Fourier output with the values corrected from the parabolic interpolation. <br  />
Indeed we don't take full advantage of the parabolic interpolation which could be used to estimate the correct position in frequency of the point. This is a choice we made because we supposed that we don't need to estimate the correct position in frequency of the peak because we already know it, that's why we use the RTFI technique; but in case of the guitar this parabolic interpolation could be also used for estimating the correct frequency during "bendings" even tough we could be precise only on high pitched notes. <br  />
 Another thing that should be evaluated is the possibility to analyze a larger buffer, this should be done considering the CPU power we have at our disposal, from this Goertzel implementation documentation we have the complexity of the algorithm which is roughly NlogN</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3dd642bdf6aceeca1d22bcb1b32cfd8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dd642bdf6aceeca1d22bcb1b32cfd8c">&#9670;&nbsp;</a></span>Wim</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Wim[<a class="el" href="fft__funct_8cpp.html#aa13333deabc79b60cecf8550c8ca21e4">Ns</a>/2]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adcb271474200e554045b11f58f5675ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcb271474200e554045b11f58f5675ef">&#9670;&nbsp;</a></span>Wre</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Wre[<a class="el" href="fft__funct_8cpp.html#aa13333deabc79b60cecf8550c8ca21e4">Ns</a>/2]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
